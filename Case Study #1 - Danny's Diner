-- 1. What is the total amount each customer spent at the restaurant?
SELECT s.customer_id,
       SUM(m.price) AS Total_Amount
FROM sales s
JOIN menu m ON s.product_id = m.product_id
GROUP BY s.customer_id
ORDER BY s.customer_id;

-- 2. How many days has each customer visited the restaurant?
SELECT s.customer_id,
       COUNT(DISTINCT s.order_date) AS 'Days'
FROM sales s
GROUP BY s.customer_id;

-- 3. What was the first item from the menu purchased by each customer?
WITH ordered_sales AS
  (SELECT s.customer_id,
          s.order_date,
          m.product_name,
          DENSE_RANK () OVER (PARTITION BY s.customer_id
                              ORDER BY s.order_date) AS Rankk
   FROM Sales s
   JOIN menu m ON s.product_id = m.product_id)
SELECT customer_id,
       product_name
FROM ordered_sales
WHERE Rankk = 1
GROUP BY customer_id,
         product_name

-- 4. What is the most purchased item on the menu and how many times was it purchased by all customers?
SELECT TOP (1) m.product_name,
       COUNT(s.product_id) AS Most_purchased
FROM sales s
JOIN menu m ON s.product_id = m.product_id
GROUP BY product_name
ORDER BY Most_purchased DESC

-- 5. Which item was the most popular for each customer?
WITH most_popular AS
  (SELECT s.customer_id,
          m.product_name,
          count(s.product_id) AS order_count,
          dense_rank () OVER (PARTITION BY s.customer_id
                              ORDER BY count(s.customer_id) DESC) AS rank
   FROM sales s
   JOIN menu m ON s.product_id = m.product_id
   GROUP BY s.customer_id,
            m.product_name)
SELECT customer_id,
       product_name,
       order_count
FROM most_popular
WHERE rank = 1;
